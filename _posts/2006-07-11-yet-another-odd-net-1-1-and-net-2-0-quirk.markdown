--- 
wordpress_id: 170
layout: post
title: Yet another odd .NET 1.1 and .NET 2.0 quirk
wordpress_url: /archive/yet-another-odd-net-1-1-and-net-2-0-quirk/
---

<p>Tonight, we discovered a slight issue when using FeedBurner&#39;s click tracking along with Community Server v2.1.&nbsp; After digging into it, I quickly saw the issue, but then as I went a little deeper, realized it was more deceiving than I&#39;d thought.</p><p>There seems to be a slight difference in the Uri class between .NET v1.1 and .NET v2.0.&nbsp; One new property in 2.0 is the &quot;OriginalString&quot;, which gives you the original value that was used to construct the Uri.</p><p>FeedBurner&#39;s click tracking works by using URLs like this:&nbsp; http://feeds.qgyen.net/~r/krobertson/~3/http%3A%2F%2Fqgyen.net%2Farchive%2F2006%2F07%2F11%2FSome-changes-around-here.aspx</p><p>The part that gets screwed up is the &quot;%3A%2F%2F&quot;, which when url decoded is &quot;://&quot;.&nbsp; In .NET 2.0, the Uri class will collapse this to &quot;:/&quot;, which is not the valid url.</p><p>To illustrate the issue with a simple, three line code sample, open up both Visual Studio 2003 and Visual Studio 2005, create a console application in both, and paste the following code.&nbsp; Set breakpoint, and you&#39;ll see the difference:</p>   <p class="MsoNormal"><font face="Courier New" size="2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="blue"><span>string</span></font> orig = <font color="maroon"><span>@&quot;http://feeds.qgyen.net/~r/krobertson/~3/http%3A%2F%2Fqgyen.net%2Farchive%2F2006%2F07%2F11%2FSome-changes-around-here.aspx&quot;</span></font>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="teal"><span>Uri</span></font> uri = <font color="blue"><span>new</span></font> <font color="teal"><span>Uri</span></font>(orig);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="blue"><span>string</span></font> back =  uri.ToString();</span></font>&nbsp;</p><p class="MsoNormal">&nbsp;</p><p class="MsoNormal">When you run this code, you&#39;ll find the the value of back is as follows:</p><blockquote><p class="MsoNormal">.NET 1.1 = &quot;http://feeds.qgyen.net/~r/krobertson/~3/http://qgyen.net/archive/2006/07/11/Some-changes-around-here.aspx&quot;</p></blockquote><blockquote><p class="MsoNormal">.NET 2.0 = &quot;http://feeds.qgyen.net/~r/krobertson/~3/http:/qgyen.net/archive/2006/07/11/Some-changes-around-here.aspx&quot;</p></blockquote><p class="MsoNormal">One of these is not like the other.&nbsp; So, is this expected behavior?&nbsp; Common sense tells me no, which leads me to think this is a bug in the .NET 2.0 framework.<br /></p><p class="MsoNormal">So basically, as the code is now, it&#39;ll work under ASP.NET v1.1, but not ASP.NET 2.0.&nbsp; The fix for ASP.NET 2.0 uses a property that isn&#39;t in ASP.NET 1.1, the code isn&#39;t providerized, and using reflection to handle it could break medium trust compatibility.&nbsp; Ahh, the joys of version incompatibilities. <br /></p>
         
