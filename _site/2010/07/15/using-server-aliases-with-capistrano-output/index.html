<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
  <head profile="http://gmpg.org/xfn/11">
    <title>Using server aliases with Capistrano output &mdash; In Valid Logic</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content="Endlessly expanding technology" />
    <meta name="author" content="Ken Robertson" />
    <meta name="generator" content="jekyll" />

    <link href="/css/site.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="/css/pygments/trac.css" rel="stylesheet" type="text/css" media="screen" />

    <link href="/atom.xml" rel="alternate" title="Ken Robertson's Atom Feed" type="application/atom+xml" />
    <link href="/rss.xml" rel="alternate" title="Ken Robertson's RSS Feed" type="application/rss+xml" />

    <link rel='index' title='In Valid Logic' href='http://invalidlogic.com/' />
  </head>

<body>
  <div id="container" class="group">

    <h1><a href="http://invalidlogic.com">In Valid Logic</a></h1>
    <div id="bubble"><p>Endlessly expanding technology</p></div>

    <div id="content" class="group">
      <h2>Using server aliases with Capistrano output</h2>

<div class="main">
  <p>One thing we often run into without deploys is "what server is that executing on?"  After updating code, we actually a fairly elaborate process to remove servers from load balancing, restart, wait for load to drop off, then add it back in to load balancing.  We also just use the AWS hostnames rather than our own since our server list pretty much changes weekly.  Wouldn't it be nice to have the ouptut show "app10" instead of "ec2-123-123-123-123.compute-1.amazonaws.com".</p>

<p>Luckily adding an alias to Capistrano is pretty easy!</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">Capistrano</span><span class="o">::</span><span class="no">ServerDefinition</span>
<span class="lineno"> 2</span>   <span class="k">def</span> <span class="nf">to_s</span>
<span class="lineno"> 3</span>     <span class="vi">@to_s</span> <span class="o">||=</span> <span class="k">begin</span>
<span class="lineno"> 4</span>       <span class="n">s</span> <span class="o">=</span> <span class="vi">@options</span><span class="o">[</span><span class="ss">:alias</span><span class="o">]</span> <span class="o">||</span> <span class="n">host</span>
<span class="lineno"> 5</span>       <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">user</span>
<span class="lineno"> 6</span>       <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">port</span> <span class="o">&amp;&amp;</span> <span class="n">port</span> <span class="o">!=</span> <span class="mi">22</span>
<span class="lineno"> 7</span>       <span class="n">s</span>
<span class="lineno"> 8</span>     <span class="k">end</span>
<span class="lineno"> 9</span>   <span class="k">end</span>
<span class="lineno">10</span> <span class="k">end</span>
</code></pre>
</div>


<p>Simply add that to your deploy.rb, or another file that is included with your recipes for utility methods.  It works simply by overriding the ServerDefinition.to_s method, which is used for the logger output.  The only change to the default method is line 4.</p>

<p>Then for your role definitions:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="s1">&#39;ec2-123-123-123-123.compute-1.amazonaws.com&#39;</span><span class="p">,</span> <span class="ss">:alias</span> <span class="o">=&gt;</span> <span class="s1">&#39;app10&#39;</span>
</code></pre>
</div>


<p>Then you see much better output:</p>

<div class="highlight"><pre><code class="text"> ** [out :: app10] Alive
</code></pre>
</div>




</div>

<div class="meta group">
  <div class="signature">
    <p>Thursday, July 15, 2010</p>
  </div>	
  <div class="tags">
    &nbsp;
  </div>
</div>

<div class="paginator">
  
    <div class="previous">&larr; <a class="previous" href="/2010/06/18/tracing-controller-filters-in-new-relic/" title="Previous post: Tracing controller filters in New Relic">Tracing controller filters in New Relic</a></div>
  
  
  
    <div class="next"><a class="next" href="/2010/08/13/presenting-on-chef-at-next-sacruby-meetup/" title="Next post: Presenting on Chef at next SacRuby Meetup">Presenting on Chef at next SacRuby Meetup</a> &rarr;</div>
  
</div>
    </div>

    <div id="sidebar">
      <h3>About</h3>
      <div class="textwidget">
        This is the personal blog of Ken Robertson.  I'm a developer at <a href="http://involver.com/">Involver</a> working in Ruby/Rails.  In a former life, I worked in .NET for many years and since moved on.<br/>
        <br/>
        In my spare time, I like to build things.  I like to experiment with different technologies to find how they best fit onto my utility belt.<br/>
        <br/>
        I sometimes blog.  You'll find those things here.<br/>
        <br/>
        I sometimes code.  You'll find those on <a href="http://github.com/krobertson">Github</a>.<br/>
      </div>

      <h3>Search</h3>
      <form method="get" action="http://www.google.com/search">
        <div>
          <label class="screen-reader-text" for="s">Search for:</label>
          <input type="text" id="s" name="q" value="" />
          <input type="hidden" name="q" value="site:invalidlogic.com" />
          <input type="submit" id="searchsubmit" value="Search" />
        </div>
      </form>

      <h3>Recent Posts</h3>
      <ul>
        
          <li><a href="/2011/01/19/love-your-dependency-management/">Love your dependency management</a></li>
        
          <li><a href="/2010/12/08/progress-through-iterating/">Progress through iterating</a></li>
        
          <li><a href="/2010/10/25/tool-enlightenment-part-2/">Tool Enlightenment, Part 2</a></li>
        
          <li><a href="/2010/10/14/tool-enlightenment/">Tool Enlightenment</a></li>
        
          <li><a href="/2010/10/08/involver-team-and-matz/">Involver Team and Matz</a></li>
        
    	</ul>
    </div>

  </div>

  <div id="footer">
    <p>The Journalist template by <a href="http://lucianmarin.com/" rel="designer">Lucian E. Marin</a></p>
  </div>
</body>
</html>